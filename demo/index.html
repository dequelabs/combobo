<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>combination-box fixture</title>
    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body id="demo">
    <h1>Combobo Box</h1>
    <pre role="img" aria-label="Combobo Gorilla">
 ."`".
 .-./ _=_ \.-.
{  (,(oYo),) }}
{{ |   "   |} }
{ { \(---)/  }}
{{  }'-=-'{ } }
{ { }._:_.{  }}
{{  } -:- { } }
{_{ }`===`{  _}
((((\)     (/))))
    </pre>
    <section class="bands">
      <div class="wrp">
        <h2>Single select</h2>
        <label for="combobox-single">Choose Band</label>
        <div class="combo-wrap">
          <input type="text" class="combobox" id="combobox-single">
          <i aria-hidden="true" class="fa trigger fa-caret-down" data-trigger="single"></i>
          <div class="listbox">
            <div class="option">Ween</div>
            <div class="option">Frank Zappa</div>
            <div class="option">Snarky Puppy</div>
            <div class="option">Umphrey's McGee</div>
            <div class="option">Keller Williams</div>
            <div class="option">Greensky Bluegrass</div>
            <div class="option">Leftover Salmon</div>
            <div class="option">Moe.</div>
            <div class="option">Family Groove Company</div>
            <div class="option">Mac Demarco</div>
            <div class="option">Lettuce</div>
          </div>
        </div>
      </div>
      <button type="button">Submit</button>
    </section>
    <section class="categories">
      <div class="wrp">
        <h2>Single select with option groups</h2>
        <label for="combobox-single-with-groups">Choose Category</label>
        <div class="combo-wrap">
          <input type="text" class="combobox" id="combobox-single-with-groups">
          <i aria-hidden="true" class="fa trigger fa-caret-down" data-trigger="single-with-groups"></i>
          <div class="listbox">
            <div class="optgroup" role="group" aria-labelledby='clothing'>
              <div class="optgroup-label" id='clothing'>Clothing</div>
              <div class="option">Shirts</div>
              <div class="option">Shorts</div>
              <div class="option">Pants</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="electronics">
              <div class="optgroup-label" id="electronics">Electronics</div>
              <div class="option">TVs</div>
              <div class="option">Game consoles</div>
              <div class="option">Music equipment</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="sporting-goods">
              <div class="optgroup-label" id="sporting-goods">Sporting Goods</div>
              <div class="option">Fishing</div>
              <div class="option">Kayaking</div>
              <div class="option">Rock climbing</div>
            </div>
          </div>
        </div>
      </div>
      <button type="button">Submit</button>
    </section>
    <section class="multiselect">
      <div class="wrp">
        <h2>Multi select</h2>
        <label for="combobox-multiselect">Choose Favorite Foods</label>
        <div class="combo-wrap">
          <input type="text" class="combobox" id="combobox-multiselect">
          <i aria-hidden="true" class="fa trigger fa-caret-down" data-trigger="multiselect"></i>
          <div class="listbox">
            <div class="option">Pizza</div>
            <div class="option">Sushi</div>
            <div class="option">Tacos</div>
            <div class="option">Salmon</div>
            <div class="option">Cheeseburger</div>
            <div class="option">Bacon Cheeseburger</div>
            <div class="option">Steak</div>
            <div class="option">Fried Chicken</div>
            <div class="option">Chicken Salad</div>
            <div class="option">Tatar Tots</div>
            <div class="option">French Fries</div>
          </div>
        </div>
      </div>
      <button type="button">Submit</button>
    </section>
    <section class="multiselect-with-groups">
      <div class="wrp">
        <h2>Multi select with option groups</h2>
        <label for="combobox-multiselect-with-groups">Choose car options</label>
        <div class="combo-wrap">
          <input type="text" class="combobox" id="combobox-multiselect-with-groups">
          <i aria-hidden="true" class="fa trigger fa-caret-down" data-trigger="multiselect-with-groups"></i>
          <div class="listbox">
            <div class="optgroup" role="group" aria-labelledby="color">
              <div class="optgroup-label" id="color">Color</div>
              <div class="option">Red</div>
              <div class="option">Yellow</div>
              <div class="option">Green</div>
              <div class="option">Orange</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="year">
              <div class="optgroup-label" id="year">Year</div>
              <div class="option">2007</div>
              <div class="option">2001</div>
              <div class="option">1999</div>
              <div class="option">2005</div>
              <div class="option">2016</div>
              <div class="option">2006</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="make">
              <div class="optgroup-label" id="make">Make</div>
              <div class="option">Ford</div>
              <div class="option">GM</div>
              <div class="option">Chrysler</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="doors">
              <div class="optgroup-label" id="doors">Doors</div>
              <div class="option">2 Door</div>
              <div class="option">4 Door</div>
            </div>
            <div class="optgroup" role="group" aria-labelledby="transmission">
              <div class="optgroup-label" id="transmission">Transmission</div>
              <div class="option">Automatic</div>
              <div class="option">Manual</div>
            </div>
          </div>
        </div>
      </div>
      <button type="button">Submit</button>
    </section>
    <section class="aria-activedescendant">
      <div class="wrp">
        <h2>aria-activedescendant</h2>
        <label for="aria-ad">Choose Favorite Food</label>
        <div class="combo-wrap">
          <input type="text" class="combobox" id="aria-ad">
          <i aria-hidden="true" class="fa trigger fa-caret-down" data-trigger="aria-activedescendant"></i>
          <div class="listbox">
            <div class="option">Pizza</div>
            <div class="option">Sushi</div>
            <div class="option">Tacos</div>
            <div class="option">Salmon</div>
            <div class="option">Cheeseburger</div>
            <div class="option">Bacon Cheeseburger</div>
            <div class="option">Steak</div>
            <div class="option">Fried Chicken</div>
            <div class="option">Chicken Salad</div>
            <div class="option">Tatar Tots</div>
            <div class="option">French Fries</div>
          </div>
        </div>
      </div>
      <button type="button">Submit</button>
    </section>
    <footer></footer>
    <script src="../dist/combobo.js" charset="utf-8"></script>
    <script>
      (function () {
        function wrapNum(str, val) {
          if (!val || str.toLowerCase().indexOf(val.toLowerCase()) === -1) {
            return str;
          }
          var regex = new RegExp(val, 'i');
          return str.replace(regex, '<span class="underline">$&</span>');
        }

        var box = {
          'single': new Combobo({
            input: '#combobox-single',
            list: '.bands .listbox',
            activeClass: 'active',
            noResultsText: 'No results found.',
            optionValue: 'foo'
          }),
          'single-with-groups': new Combobo({
            input: '#combobox-single-with-groups',
            list: '.categories .listbox',
            groups: '.optgroup',
            activeClass: 'active',
            noResultsText: 'No results found.',
            optionValue: function (option) {
              var inputVal = box['single-with-groups'].input.value;
              return wrapNum(option.innerText, inputVal);
            },
            announcement: {
              groupChange: groupChangeHandler
            }
          }),
          'multiselect': new Combobo({
            input: '#combobox-multiselect',
            list: '.multiselect .listbox',
            activeClass: 'active',
            multiselect: true,
            selectionValue: function (selectedOptions) {
              return selectedOptions.length > 1 ?
                '{ ' + selectedOptions.length +  ' selected }' :
                selectedOptions[0].innerText.trim();
            },
            noResultsText: 'No results found.',
            optionValue: function (option) {
              var inputVal = box.multiselect.input.value;
              return wrapNum(option.innerText, inputVal)
            }
          }),
          'multiselect-with-groups': new Combobo({
            input: '#combobox-multiselect-with-groups',
            list: '.multiselect-with-groups .listbox',
            activeClass: 'active',
            multiselect: true,
            groups: '.optgroup',
            noResultsText: 'No results found.',
            announcement: {
              groupChange: groupChangeHandler
            }
          }),
          'aria-activedescendant': new Combobo({
            input: '#aria-ad',
            list: '.aria-activedescendant .listbox',
            activeClass: 'active',
            useLiveRegion: false
          })
        };

        function groupChangeHandler(newGroup) {
          var groupLabel = newGroup.querySelector('.optgroup-label').innerText;
          var len = Array.prototype.slice.call(
            newGroup.querySelectorAll('.option')
          ).filter(function (opt) {
            return opt.style.display !== 'none';
          }).length;

          return groupLabel + ' group entered, with ' + len + ' options.';
        }

        window.box = box;

        // handle trigger clicks to toggle state of its combobox
        Array.prototype.slice.call(
          document.querySelectorAll('.trigger')
        ).forEach(function (trigger) {
          var instName = trigger.getAttribute('data-trigger');
          var inst = box[instName];
          trigger.addEventListener('click', function (e) {
            e.stopPropagation();
            console.log('clicked!?!?!');
            console.log(inst.isOpen);
            inst[inst.isOpen ? 'closeList' : 'openList']();
          });
        });
      }());
    </script>
  </body>
</html>
